<div class="container my-5">
  <h2 class="mb-4">üìã Datos del Pedido</h2>

  @if (!mostrarMensajeExito) {
    <div class="row">
      <div class="col-md-8">
        <div class="card">
          <div class="card-body">
            <form [formGroup]="formularioPedido" (ngSubmit)="enviarPedido()">
              
              <!-- Nombre -->
              <div class="mb-3">
                <label for="nombre" class="form-label">Nombre completo *</label>
                <input 
                  type="text" 
                  class="form-control" 
                  id="nombre" 
                  formControlName="nombre"
                  [class.is-invalid]="nombre?.invalid && nombre?.touched">
                @if (nombre?.invalid && nombre?.touched) {
                  <div class="invalid-feedback">
                    @if (nombre?.errors?.['required']) {
                      El nombre es obligatorio
                    }
                    @if (nombre?.errors?.['minlength']) {
                      El nombre debe tener al menos 3 caracteres
                    }
                  </div>
                }
              </div>

              <!-- Email -->
              <div class="mb-3">
                <label for="email" class="form-label">Correo electr√≥nico *</label>
                <input 
                  type="email" 
                  class="form-control" 
                  id="email" 
                  formControlName="email"
                  [class.is-invalid]="email?.invalid && email?.touched">
                @if (email?.invalid && email?.touched) {
                  <div class="invalid-feedback">
                    @if (email?.errors?.['required']) {
                      El correo es obligatorio
                    }
                    @if (email?.errors?.['email']) {
                      Ingresa un correo v√°lido
                    }
                  </div>
                }
              </div>

              <!-- N√∫mero de mesa (solo si es servicio a mesa) -->
              @if (tipoServicio === 'mesa') {
                <div class="mb-3">
                  <label for="numeroMesa" class="form-label">N√∫mero de mesa *</label>
                  <input 
                    type="number" 
                    class="form-control" 
                    id="numeroMesa" 
                    formControlName="numeroMesa"
                    [class.is-invalid]="numeroMesa?.invalid && numeroMesa?.touched">
                  @if (numeroMesa?.invalid && numeroMesa?.touched) {
                    <div class="invalid-feedback">
                      @if (numeroMesa?.errors?.['required']) {
                        El n√∫mero de mesa es obligatorio
                      }
                      @if (numeroMesa?.errors?.['min']) {
                        Ingresa un n√∫mero de mesa v√°lido
                      }
                    </div>
                  }
                </div>
              }

              <!-- Observaciones -->
              <div class="mb-3">
                <label for="observaciones" class="form-label">Observaciones (opcional)</label>
                <textarea 
                  class="form-control" 
                  id="observaciones" 
                  rows="3" 
                  formControlName="observaciones"
                  placeholder="Alergias, preferencias, etc.">
                </textarea>
              </div>

              <button 
                type="submit" 
                class="btn btn-primary btn-lg w-100"
                [disabled]="formularioPedido.invalid">
                ‚úÖ Enviar Pedido
              </button>
            </form>
          </div>
        </div>
      </div>

      <!-- Resumen del pedido -->
      <div class="col-md-4">
        <div class="card sticky-top" style="top: 100px;">
          <div class="card-body">
            <h5 class="card-title">Resumen</h5>
            
            <div class="mb-3">
              <div class="d-flex justify-content-between mb-2">
                <span class="text-muted">Tipo de servicio:</span>
                <strong>{{ tipoServicio === 'mesa' ? 'ü™ë A mesa' : 'ü•§ Mostrador' }}</strong>
              </div>
              <div class="d-flex justify-content-between mb-2">
                <span class="text-muted">M√©todo de pago:</span>
                <strong>{{ metodoPago === 'efectivo' ? 'üíµ Efectivo' : 'üí≥ Online' }}</strong>
              </div>
            </div>

            <hr>

            <div class="d-flex justify-content-between mb-3">
              <strong>Total a pagar:</strong>
              <strong class="text-primary fs-4">${{ total.toFixed(2) }}</strong>
            </div>

            <a routerLink="/cafeteria/checkout" class="btn btn-outline-secondary w-100">
              ‚Üê Volver al pedido
            </a>
          </div>
        </div>
      </div>
    </div>
  } @else {
    <!-- Mensaje de √©xito -->
    <div class="alert alert-success text-center py-5">
      <h3>‚úÖ ¬°Pedido enviado con √©xito!</h3>
      <p class="mb-0">Recibir√°s un correo de confirmaci√≥n en breve.</p>
      <p class="text-muted">Redirigiendo a productos...</p>
    </div>
  }
</div>
